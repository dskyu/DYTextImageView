//
//  YBLHttpResponseListener.m
//  ybole
//
//  Created by bunny on 12-10-23.
//  Copyright (c) 2012年 Ybole. All rights reserved.
//

/*
 {"msg": "ok", "val": {"content": [{"content": "\u516c\u53f8\u6269\u5927\u5347\u7ea7:\u7d27\u6025\u62db\u8058\u5316\u5986\u5e08.\u52a9\u7406.\u54a8\u5ba2\u95e8\u5e02.\u54048\u540d...\u7535\u8bdd:13412885805 ", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 580, "description": " \u7528\u5fc3\u5bf9\u5f85\u8eab\u8fb9\u7684\u6bcf\u4e00\u4e2a\u4eba\uff0c\u4f60\u5e0c\u671b\u522b\u4eba\u600e\u6837\u5f85\u4f60\uff1b\u4f60\u4e5f\u8981\u600e\u6837\u5f85\u522b\u4eba\uff01\n\u5e73\u5e73\u6de1\u6de1\u624d\u662f\u771f\uff0c\u5f00\u5f00\u5fc3\u5fc3\u8fc7\u597d\u6bcf\u4e00\u5929\uff0c\u591a\u5173\u7231\u4e00\u70b9\u4f60\u8eab\u8fb9\u7684\u4eba\u3002\u4f60\u4e00\u5b9a\u4f1a\u5f97\u5230\u5feb\u4e50\u7684\u3002", "friends_count": 81, "isrealname": 1, "verified_reason": "", "followers_count": 66, "isent": 0, "isvip": 0}, "user_tencent_id": "5DE5637B2D31E598093BE8D64196EC22", "face": "http://app.qlogo.cn/mbloghead/fcbc207a4a9b89ae9a18/50", "location": "\u4e2d\u56fd \u4e1c\u839e", "nickname": "\u949f\u7231\u4e00\u751f\u65b0\u6d3e\u6444\u5f71\u8fde\u9501\u540d\u5e97", "id": "5149e529cea175035a56ec51"}, "time": 1364140743.0, "company": [], "id": "514f231acea17560080bf348", "favorite_count": 0, "location": []}, {"content": "\u516c\u53f8\u8bda\u62db\u524d\u53f0\u4e00\u540d\u3001\u5ba2\u6237\u4ee3\u88682\u540d\uff0c\u5ba2\u6237\u7ecf\u74062\u540d\uff0c\u6709\u76f8\u5173\u91d1\u878d\u884c\u4e1a\u7ecf\u9a8c\u4f18\u5148\u5f55\u53d6", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 612, "description": "", "friends_count": 124, "isrealname": 1, "verified_reason": "", "followers_count": 125, "isent": 0, "isvip": 0}, "user_tencent_id": "FB3003B44A878E47FBB746D4C3C095C7", "face": "http://app.qlogo.cn/mbloghead/9382b890f5f91e250926/50", "location": "\u4e2d\u56fd \u6e56\u5357 \u90f4\u5dde", "nickname": "\u5174\u6797", "id": "514f2328cea17560080bf34d"}, "time": 1364140667.0, "company": [], "id": "514f2328cea17560080bf34e", "favorite_count": 0, "location": []}, {"content": "0325\u6025\u8058 CEO \u4e91\u8ba1\u7b97SOA\u5927\u6570\u636e\u89c4\u5212SE \u603b\u76d1 \u67b6\u6784\u5e08 \u6b63\u6781\u6750\u6599\u8425\u9500 \u8bbe\u8ba1\u9662\u957f \u57ce\u5e02\u603b HRD \u5730\u4ea7 \u6709\u8272\u91d1\u5c5e \u77ff\u4e1a IT\u7b49\u4e2d\u9ad8\u7ba1", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 354, "description": "", "friends_count": 24, "isrealname": 1, "verified_reason": "", "followers_count": 51, "isent": 0, "isvip": 0}, "user_tencent_id": "CC57C0EA48E690E45D5DF5B85840DCA9", "face": "/50", "location": "\u4e2d\u56fd \u5e7f\u4e1c \u6df1\u5733", "nickname": "David", "id": "50f41e4dcea1752e35508899"}, "time": 1364140572.0, "company": [], "id": "514f2312cea17560080bf342", "favorite_count": 0, "location": []}, {"content": "\u5357\u624d\u5168\u63a5\u89e6\u4e4b\u8def\u5c55\u2014\u2014\u5357\u624d\u6587\u5316\u6d3b\u52a8\u4ea4\u6d41\u6708\u63a8\u5e7f+\u6625\u5b63\u62db\u8058\u30023\u670825\u65e5\u300126\u65e5\uff0c\u6211\u4eec\u4f1a\u5728\u4e94\u7f8a\u5e7f\u573a\u8fdb\u884c\u8def\u5c55\uff0c\u63a8\u5e7f\u6b64\u6b21\u4ea4\u6d41\u6708\u5e76\u5ba3\u4f20\u6625\u5b63\u62db\u8058\u3002\u73b0\u62db\u8058\u7f51\u7edc\u90e8\u4ea7\u54c1\u4e13\u5458\u548cWeb\u7814\u53d1\u4e13\u5458\uff0c\u4eba\u529b\u8d44\u6e90\u90e8\u4eba\u4e8b\u4e13\u5458\uff0c\u7b80\u5386\u622a\u6b62\u65f6\u95f4\uff1a2013\u5e743\u670828\u65e5\u665a22:00 \u8054\u7cfb\u7535\u8bdd\uff1a131... <a href=\"http://url.cn/9e0OxN\" target=\"_blank\">http://url.cn/9e0OxN</a> ", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 272, "description": "", "friends_count": 99, "isrealname": 1, "verified_reason": "", "followers_count": 69, "isent": 0, "isvip": 0}, "user_tencent_id": "320AE4AC2C82C58DFB83D699519E259B", "face": "/50", "location": "\u4e2d\u56fd \u67f3\u5dde", "nickname": "\u8d24\u513f", "id": "514f21d1cea17560080bf31b"}, "time": 1364140375.0, "company": [], "id": "514f21d1cea17560080bf31c", "favorite_count": 0, "location": []}, {"content": "\u6025\u8058\uff1a\u524d\u53f0\u3001\u7f8e\u5de5\u3001\u8d22\u52a1", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 681, "description": "\u76ee\u524d\u4ece\u4e8b\u7535\u5b50\u5546\u52a1\u884c\u4e1a\uff0c\u4e3b\u8425\u97e9\u7248\u4f11\u95f2\u98ce\u683c\u7684\u5973\u88c5\uff0c\u6279\u53d1\uff0c\u96f6\u552e\uff0c\u56e2\u8d2d", "friends_count": 786, "isrealname": 1, "verified_reason": "", "followers_count": 683, "isent": 0, "isvip": 0}, "user_tencent_id": "039AF1EC489E787275937A084007AED3", "face": "http://app.qlogo.cn/mbloghead/699b5b345a9eaeaf3978/50", "location": "\u4e2d\u56fd \u5e7f\u5dde", "nickname": "\u90ed\u51ef\u6d32", "id": "50fd4b7ccea1753f72142cf5"}, "time": 1364140368.0, "company": [], "id": "514f21c9cea17560080bf317", "favorite_count": 0, "location": []}, {"content": "\u672c\u4eba:\u7d2b\u67ab\uff0c\u804c\u4e1a\u7f8e\u53d1\uff01\u73b0\u5728\u300a\u4e0a\u6d77\u5e02\u3001\u4eba\u6c11\u5e7f\u573a\u3001\u8679\u6c5f\u8def\u3001\u300b\u201c\u6c38\u742a\u201d\u4e0a\u73ed\uff01\u62c5\u4efb\u6280\u5e08\uff01\u5982\u6709\u201d\u597d\u53cb\u201d\u5728\u4e0a\u6d77\u9644\u8fd1\uff0c\u53ef\u4ee5\u4e00\u8d77\u805a\u4e00\u805a\uff01\u8fd8\u6709\u5c31\u662f\uff01\u672c\u5e97\u62db\u4eba:\u6280\u5e083\u540d\uff01\u53d1\u578b\u5e085\uff01\u7f8e\u5bb9\u5e0810\u540d\uff01\u5b66\u5f92\u82e5\u5e72\u540d\u2026\u5982\u6709\u62db\u5a09\u8005\u8bf7\u62e8\u6253\u672c\u4eba\u70ed\u7ebf:15152204022\u2026", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 93, "description": "", "friends_count": 3, "isrealname": 1, "verified_reason": "", "followers_count": 11, "isent": 0, "isvip": 0}, "user_tencent_id": "85A57DD735447141042F49119C51A1CA", "face": "/50", "location": "\u4e2d\u56fd \u56db\u5ddd \u5357\u5145", "nickname": "\u5de6\u7d2b\u67ab", "id": "514f2094cea17560080bf2f4"}, "time": 1364140107.0, "company": [], "id": "514f2094cea17560080bf2f5", "favorite_count": 0, "location": []}, {"content": "\u6025\u62db\u624b\u5de5\u5236\u4f5c\u4eba\u5458 \u7535\u8bdd15813723317\u621613715863374 \u8054\u7cfb\u4eba\uff1a\u5434\u8001\u5e08", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 23, "description": "", "friends_count": 10, "isrealname": 1, "verified_reason": "", "followers_count": 7, "isent": 0, "isvip": 0}, "user_tencent_id": "C8B117CEBC3079CEF720B06DFF2C5C30", "face": "http://app.qlogo.cn/mbloghead/5249ada34542ed83808c/50", "location": "\u4e2d\u56fd \u6df1\u5733", "nickname": "\u7ea2\u59d0", "id": "514f2092cea17560080bf2ec"}, "time": 1364139955.0, "company": [], "id": "514f2092cea17560080bf2ed", "favorite_count": 0, "location": []}, {"content": "\u62db\u7f8e\u5bb9 \u7f8e\u7532 \u5316\u5986\u5e08\u591a\u540d\uff0c\u751f\u624b\u53ef\u514d\u8d39\u57f9\u8bad\uff0c\u8054\u7cfb\u7535\u8bdd\uff1a15992136733,\uff08\u6025\u62db\u719f\u624b\uff09      ", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 190, "description": "\u6211\u7231\u5c0f\u8475\u82b1\u3002", "friends_count": 40, "isrealname": 1, "verified_reason": "", "followers_count": 31, "isent": 0, "isvip": 0}, "user_tencent_id": "EE3D8D41BAA1A79F7EC5979C2DBBF56C", "face": "http://app.qlogo.cn/mbloghead/4b6239469b6109ccab44/50", "location": "\u4e2d\u56fd \u5e7f\u4e1c \u6c5f\u95e8", "nickname": "\u949f\u949f\u949f\u5b87\u76db", "id": "514587a2cea1753393ae98ff"}, "time": 1364139832.0, "company": [], "id": "514f21dbcea17560080bf320", "favorite_count": 0, "location": []}, {"content": "\u672c\u5e97\u6025\u62db\u6587\u5458\u4e00\u540d\uff0c\u7535\u8bdd\uff1a13518384889\u3002", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 2, "description": "", "friends_count": 4, "isrealname": 2, "verified_reason": "", "followers_count": 31, "isent": 0, "isvip": 0}, "user_tencent_id": "667541AC590B8657522A69AF5D733404", "face": "/50", "location": "\u4e2d\u56fd \u6cf8\u5dde", "nickname": "87", "id": "50fded27cea1753f721464ad"}, "time": 1364139758.0, "company": [], "id": "514f1f49cea17560080bf2bd", "favorite_count": 0, "location": []}, {"content": "\u6025\u62db\u6587\u5458\uff0c\u624b\u673a\u9500\u552e\u5458", "source": "tencent_weibo", "apply_count": 0, "user": {"tencentweiboinfo": {"statuses_count": 172, "description": "\u5e0c\u671b\u5e78\u798f,\u5f00\u5fc3.", "friends_count": 87, "isrealname": 1, "verified_reason": "", "followers_count": 46, "isent": 0, "isvip": 0}, "user_tencent_id": "2A4D58EB40113A137DD2FF163D445D36", "face": "http://app.qlogo.cn/mbloghead/096b9f18acbf3ab53cd4/50", "location": "\u4e2d\u56fd \u4f5b\u5c71", "nickname": "\u9ed1\u8272\u857e\u4e1d", "id": "514f2092cea17560080bf2f0"}, "time": 1364139720.0, "company": [], "id": "514f2092cea17560080bf2f1", "favorite_count": 0, "location": []}], "highlight_words": [], "followed": false, "count_query": 10}, "ret": 0}
 */

#import "YBLHttpResponseListener.h"
//#import "YBLException.h"
#import "YBLConstant.h"
#import "YBLModel.h"

static YBLHttpResponseListener *_responseListener = nil;

@implementation YBLHttpResponseListener


+ (YBLHttpResponseListener *) shareHttpResponseListener  
{
    if (_responseListener == nil) {
        _responseListener = [[YBLHttpResponseListener alloc] init];
    }
    return _responseListener;
}

- (NSString *) getReturnValue:(ASIHTTPRequest *) request
{
 //   [self checkRequest:request];

    NSDictionary *dic = [[request responseString] objectFromJSONStringWithParseOptions:JKParseOptionLooseUnicode];
    
    NSInteger error = [[dic objectForKey:@"ret"] integerValue];
    
    if (error == ERROR_OK) {
        if ([dic objectForKey:@"val"] == [NSNull null]) {
            return @"ok";
        }else{
            return [[dic objectForKey:@"val"] JSONString];
        }
    }else{
            // handle errors
    }
    
    return @"ok";
}

#pragma mark -
#pragma mark ASIHttpRequestDelegate

- (void)requestStart:(ASIHTTPRequest *)request
{
    
}

- (void)requestFinished:(YBLHttpRequest *)request
{

    @try {
        
        NSString *responseString = [self getReturnValue:request];
    
        id delegate = request.responseDelegate;
        
        switch ([request tag]) {
            case YBLApiSearchJobByName: //search_weibo_jobs
            {
                if ([delegate conformsToProtocol:@protocol(YBLHttpResponseDelegate)] && [delegate respondsToSelector:@selector(weiboSearchJobsRecevied:)]) {
                    YBLJobArray *array = [[YBLJobArray alloc] initWithString:responseString];
                    [delegate weiboSearchJobsRecevied:array];
                }
                
                break;
            }
            default:
                break;
        }
    }
    @catch (id exception) {
        //[exception showWithLoadStatus:YES andHandle:request];
    }
    @finally {
        
    }
    
}

- (void)requestFailed:(YBLHttpRequest *)request
{
    // NSLog(@"fail %d",[request responseStatusCode]);
//    @try {
//        [[NSNotificationCenter defaultCenter] postNotificationName:TimeoutNotification object:nil];
//        [self checkRequest:request];
//        [YBLWeibo showToastWithText:NSLocalizedString(@"不好意思，加载出错，请稍后重试", @"load failure")];
//    }
//    @catch (id exception) {
//        NSLog(@"%@",[ASIHTTPRequest sessionCookies]);
//        [exception showWithLoadStatus:YES andHandle:request];
//    }
//    @finally {
//        
//    }
}


@end
